!function(e,t,n){function r(n,i){if(!t[n]){if(!e[n]){var a="function"==typeof require&&require;if(!i&&a)return a(n,!0);if(o)return o(n,!0);throw new Error("Cannot find module '"+n+"'")}var s=t[n]={exports:{}};e[n][0].call(s.exports,function(t){var o=e[n][1][t];return r(o?o:t)},s,s.exports)}return t[n].exports}for(var o="function"==typeof require&&require,i=0;i<n.length;i++)r(n[i]);return r}({1:[function(e){function t(){var e=new p.form,t=new p.textbox,n=new l.conditional,r=new l.push,o=new l.remove;return n.condition.binding="[]",n.actions["true"]=[r,o],e.path="[/newTodo]",e.views.content.add(t),e.actions.submit=[n],t.classes.value="newTodo",t.placeholder.value="What needs to be done?",t.value.binding="[]",r.source.binding='(object "label" [])',r.target.binding="[/todos]",o.target.binding="[]",e}function n(){var e=new p.container,n=new p.heading;return n.text.value="todos",e.tagName="header",e.views.content.add([n,t()]),e}function r(){var e=new p.container,t=new p.container,n=new p.checkbox,r=new p.label,o=new l.set,i=new p.button,a=new l.remove,s=new p.form,u=new l.set,c=new p.textbox;return n.showLabel.value=!1,n.classes.value="toggle",n.checked.binding="[completed]",r.text.binding="[label]",r.actions.dblclick=[o],o.source.value=!0,o.target.binding="[editing]",i.classes.value="destroy",i.actions.click=[a],a.target.binding="[]",t.classes.value="view",t.views.content.add([n,r,i]),e.tagName="li",e.classes.binding='(join "" (? [completed] "completed") (? [editing] "editing"))',e.views.content.add([t,s]),c.classes.value="edit",c.value.binding="[label]",c.actions.blur=[u],u.source.value=!1,u.target.binding="[editing]",s.actions.submit=[u],s.views.content.add(c),e}function o(){var e=new p.list;return e.tagName="ul",e.classes.value="todoList",e.path="[todos]",e.list.binding=d,e.list.template=r(),e}function i(){var e=new p.container,t=new p.checkbox,n=new l.forEach,r=new l.set;return n.path="[/todos]",n.target.binding=d,n.actions.forEach=[r],r.source.binding="[/toggleAll]",r.target.binding="[completed]",t.showLabel.value=!1,t.checked.binding="[/toggleAll]",t.classes.value="toggleAll",t.visible.binding="(&& [/todos] (> (length [/todos]) 0))",t.actions.change=[n],e.tagName="section",e.classes.value="main",e.views.content.add([t,o()]),e}function a(){var e=new p.container,t=new p.html,n=new p.list,r=new p.container,o=new p.anchor,i=new l.set,a=new p.button,s=new l.set;return t.html.binding='({todosLeft (join "" "<strong>" todosLeft "</strong> item" (? (!= todosLeft 1) "s") " left")} (filter [/todos] {todo (! todo.completed)}).length)',t.classes.value="todoCount",n.path="[filters]",n.list.binding="[]",n.list.template=r,n.classes.value="filters",n.tagName="ul",o.text.binding="[label]",o.href.binding='(join "" "#/" [filter])',o.external=!0,o.classes.binding='(? (= [filter] [/filter]) "selected" "")',o.actions.click=[i],r.views.content.add(o),r.tagName="li",i.source.binding="[filter]",i.target.binding="[/filter]",a.path="[/todos]",a.text.binding='(join "" "Clear completed (" (filter [] {todo todo.completed}).length ")")',a.classes.value="clearCompleted",a.visible.binding="(!(!(findOne [] {todo todo.completed})))",a.actions.click=[s],s.target.binding="[]",s.source.binding="(filter [] {todo (!todo.completed)})",e.tagName="footer",e.views.content.add([t,n,a]),e.visible.binding="(&& [/todos] (> (length [/todos]) 0))",e}function s(){var e=new h.pageLoad,t=new l.browserStorage,n=new h.modelChange,r=new l.browserStorage;return t.source.value="todos",t.method.value="get",t.target.binding="[/todos]",e.actions.load=[t,v],r.target.value="todos",r.method.value="set",r.source.binding="[/todos]",n.watch.binding="[/todos]",n.actions.change=[r],[e,n]}function u(){f.views.renderTarget=".todoapp",f.views.add([n(),i(),a()])}var c=e("gaffa"),f=new c,p=f.views.constructors=e("./views"),l=f.actions.constructors=e("./actions"),h=f.behaviours.constructors=e("./behaviours"),d='(? (= [/filter] "all") [] (? (= [/filter] "completed") (filter [] {todo todo.completed}) (filter [] {todo (! todo.completed)})))',v=new l.set;v.source.binding='({parts (? (> parts.length 1) (last (split (last parts) "/")) "all")}(split windowLocation "#"))',v.target.binding="[/filter]",f.model.set({filters:[{label:"All",filter:"all"},{label:"Active",filter:"active"},{label:"Completed",filter:"completed"}],filter:"all"}),f.behaviours.add(s()),window.onhashchange=function(){f.actions.trigger([v],{gaffa:f})},window.onload=u},{"./views":2,"./actions":3,"./behaviours":4,gaffa:5}],2:[function(e,t){t.exports={container:e("gaffa/views/container"),heading:e("gaffa/views/heading"),list:e("gaffa/views/list"),group:e("gaffa/views/group"),form:e("gaffa/views/form"),label:e("gaffa/views/label"),text:e("gaffa/views/text"),button:e("gaffa/views/button"),anchor:e("gaffa/views/anchor"),image:e("gaffa/views/image"),html:e("gaffa/views/html"),textbox:e("gaffa/views/textbox"),checkbox:e("gaffa/views/checkbox")}},{"gaffa/views/container":6,"gaffa/views/list":7,"gaffa/views/heading":8,"gaffa/views/group":9,"gaffa/views/form":10,"gaffa/views/label":11,"gaffa/views/text":12,"gaffa/views/button":13,"gaffa/views/anchor":14,"gaffa/views/image":15,"gaffa/views/html":16,"gaffa/views/textbox":17,"gaffa/views/checkbox":18}],3:[function(e,t){t.exports={set:e("gaffa/actions/set"),ajax:e("gaffa/actions/ajax"),push:e("gaffa/actions/push"),remove:e("gaffa/actions/remove"),toggle:e("gaffa/actions/toggle"),conditional:e("gaffa/actions/conditional"),forEach:e("gaffa/actions/forEach"),browserStorage:e("gaffa/actions/browserStorage")}},{"gaffa/actions/set":19,"gaffa/actions/ajax":20,"gaffa/actions/remove":21,"gaffa/actions/push":22,"gaffa/actions/toggle":23,"gaffa/actions/conditional":24,"gaffa/actions/forEach":25,"gaffa/actions/browserStorage":26}],4:[function(e,t){t.exports={pageLoad:e("gaffa/behaviours/pageLoad"),modelChange:e("gaffa/behaviours/modelChange")}},{"gaffa/behaviours/pageLoad":27,"gaffa/behaviours/modelChange":28}],29:[function(e,t){!function(){for(var e="undefined"!=typeof window?window:this,n=0,r=["webkit","moz"],o=e.requestAnimationFrame,i=e.cancelAnimationFrame,a=r.length;--a>=0&&!o;)o=e[r[a]+"RequestAnimationFrame"],i=e[r[a]+"CancelAnimationFrame"];o&&i||(o=function(e){var t=+Date.now(),r=Math.max(n+16,t);return setTimeout(function(){e(n=r)},r-t)},i=clearTimeout),i||(e.cancelAnimationFrame=function(e){clearTimeout(e)}),e.requestAnimationFrame=o,e.cancelAnimationFrame=i,t.exports={requestAnimationFrame:o,cancelAnimationFrame:i}}()},{}],5:[function(e,t){!function(){"use strict";function n(e,t){var n;t||(t=Object),t.prototype||(t.prototype={}),n=t.prototype,e.prototype=Object.create(t.prototype),e.prototype.__super__=n;var r=new Function("child","return function "+e.name+"(){child.prototype.__super__.constructor.apply(this, arguments);return child.apply(this, arguments);}")(e);return r.prototype=e.prototype,r.prototype.constructor=e.prototype.constructor=r,r}function r(e,t){for(var n=0;n<e.length&&!t(e[n],n,e);n++);return e}function o(e){var t=e.split("?"),n={};if(t.length>1){var o=t.pop().split("&");r(o,function(e){var t=e.split("="),r=window.unescape(t[0]),o=window.unescape(t[1]);n[r]=o})}return n}function i(e){var t="";for(var n in e)e.hasOwnProperty(n)&&void 0!==e[n]&&(t+=(t.length?"&":"?")+n+"="+e[n]);return t}function a(e){var t;if("object"!=typeof e&&(e={}),e.cache===!1&&(e.data=e.data||{},e.data._=(new Date).getTime()),"get"===e.type.toLowerCase()&&"object"==typeof e.data){t=o(e.url);for(var n in e.data)e.data.hasOwnProperty(n)&&(t[n]=e.data[n]);e.url=e.url.split("?").shift()+i(t),e.data=null}var r=new XMLHttpRequest;r.addEventListener("progress",e.progress,!1),r.addEventListener("load",function(t){if(t.target.status>=400)return e.error&&e.error(t),void 0;var n=t.target.responseText;if("json"===e.dataType)if(""===n)n=void 0;else try{n=JSON.parse(n)}catch(r){return e.error&&e.error(t,r),void 0}e.success&&e.success(n,t)},!1),r.addEventListener("error",e.error,!1),r.addEventListener("abort",e.abort,!1),r.addEventListener("loadend",e.complete,!1),r.open(e.type||"get",e.url,!0),e.contentType!==!1&&r.setRequestHeader("Content-Type",e.contentType||"application/json; charset=utf-8"),r.setRequestHeader("X-Requested-With",e.requestedWith||"XMLHttpRequest"),r.setRequestHeader("x-gaffa","request"),e.auth&&r.setRequestHeader("Authorization",e.auth);for(var n in e.headers)r.setRequestHeader(n,e.headers[n]);e.processData!==!1&&"json"===e.dataType&&(e.data=JSON.stringify(e.data)),r.send(e.data&&e.data)}function s(e){for(var t=e.viewModel;!t&&e;)e=e.parentNode,e&&(t=e.viewModel);return t}function u(e,t){return function(n,r){var r=r.all();return e.apply(t,r)}}function c(e,t,n){var o={},i=e.model.get("(map items "+n+")",{items:t});if(t&&"object"==typeof t){if(!Array.isArray(t))throw"Object collections are not currently supported";r(i,function(e){o[e]=null})}return Object.keys(o)}function f(e){var t,n=e.parentNode;return n?(t=e.nextSibling,n.removeChild(e),function(){t?n.insertBefore(e,t&&t.parent&&t):n.appendChild(e)}):!1}function p(e,t,n,r){e.trigger(t,n,r)}function l(e,t,n,o){Array.isArray(e)&&r(e,function(e){p(e,t,n,o)})}function h(e,t,n){var r,o="string"==typeof e?document.querySelectorAll(e)[0]:e;o&&o.childNodes&&(r=o.childNodes[n]),r?o.insertBefore(t,r):o.appendChild(t)}function d(e){for(var t=e.gaffa.gedi,n=[],r=e;r;)null!=r.key&&n.push(t.paths.create(r.key)),null!=r.path&&n.push(r.path),r=r.parent;return t.paths.resolve.apply(this,n.reverse())}function v(e,t){function n(e,t){for(var o in t){var a=t[o],s=e[o];if("object"==typeof a&&null!=a)if(a instanceof Array)s=new a.constructor,r(a,function(e){var t=new e.constructor;n(t,e),s.push(t)});else if(a instanceof Date)s=new Date(a);else{if(i.indexOf(a)>=0){e[o]=a;continue}i.push(a),s=s||Object.create(a),n(s,a)}else void 0===s&&(s=a);e[o]=s}}var o=Array.prototype.slice.call(arguments),e=o[0]||{},t=o[1]||{},i=[];return n(e,t),void 0!==o[2]&&null!==o[2]&&(o[0]=o.shift(),v.apply(this,o)),e}function g(e){$=$||function(){$=z("style",{type:"text/css","class":"dropdownDefaultStyle"});var e=function(){window.document.head?window.document.head.insertBefore($):setTimeout(e,100)};return e(),$}(),$.styleSheet?$.styleSheet.cssText=e:$.innerHTML+=e}function y(e,t,n){if(!(e instanceof D)){if(!n[e.type])throw"No constructor is loaded to handle view of type "+e.type;e=new n[e.type](e)}for(var r in e.views){e.views[r]instanceof C||(e.views[r]=new C(e.views[r]));for(var o=e.views[r],i=0;i<o.length;i++){var a=m(o[i],t);o[i]=a,a.parentContainer=o}}for(var r in e.actions)for(var s=e.actions[r],u=0;u<s.length;u++){var c=w(s[u],t);s[u]=c,c.parentContainer=s}if(e.behaviours)for(var f=0;f<e.behaviours.length;f++){var p=b(e.behaviours[f],t);e.behaviours[f]=p,p.parentContainer=e.behaviours}return e}function m(e,t){return y(e,t,t.views.constructors)}function w(e,t){return y(e,t,t.actions.constructors)}function b(e,t){return y(e,t,t.behaviours.constructors)}function _(e){e&&(e=e instanceof Array?e:[e],e=e.slice(),r(e,function(e){e.remove()}))}function x(e,t,n){var r=new e.constructor,o=Array.isArray(e)||e instanceof Array&&[]||{},i=["gaffa","parent","parentContainer","renderedElement","_removeHandlers","gediCallbacks","__super__"],a=["type"];t&&(i=i.concat(t)),n&&(a=a.concat(n));for(var s in e)(a.indexOf(s)>=0||e.hasOwnProperty(s)&&i.indexOf(s)<0&&!Z(r[s],e[s]))&&(o[s]=e[s]);return Object.keys(o).length?o:void 0}function A(e,t,n){for(var r,o=e;o&&!r;)r=o.group,o=o.parent;return{__trackKeys__:t,viewItem:e,groupKey:r,modelTarget:n&&n.target}}function N(e,t){t&&e.update(e.parent,e.value),e.sameAsPrevious()||(e.nextUpdate&&(et(e.nextUpdate),e.nextUpdate=null),e.nextUpdate=Y(function(){e.update(e.parent,e.value)}))}function k(e){return function(t){var n,r;if(t){if(r=A(e.parent,e.trackKeys,t),t===!0)n=e.gaffa.model.get(e.binding,e,r);else if(e.binding){if(e.ignoreTargets&&t.target.toString().match(e.ignoreTargets))return;n=t.getValue(r)}e.keys=n&&n.__gaffaKeys__,e.value=n}e.update&&N(e,t===!0)}}function S(e){if(this.parent=e,null==this.binding)return this.update&&this.update(e,this.value),void 0;var t=k(this);this.gaffa.model.bind(this.binding,t,this),t(!0)}function P(e){return e&&"object"==typeof e?Object.keys(e):e}function j(e,t){if(e&&t&&"object"==typeof e&&"object"==typeof t){var n=Object.keys(e);if(n.length!==t.length)return;for(var r=0;r<t.length;r++)if(t[r]!==n[r])return;return!0}return e===t}function T(e){if("function"==typeof e)this.update=e;else for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);this.gediCallbacks=[]}function C(e){var t=this;if(e instanceof Array)for(var n=0;n<e.length;n++)t.push(e[n])}function E(e,t){if(e&&"object"==typeof e&&t&&"object"==typeof t)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}function O(e){for(var t in e)e[t]instanceof T&&e[t].debind();e.bound=!1}function L(e){if(e.parentContainer){var t=e.parentContainer.indexOf(e);t>=0&&e.parentContainer.splice(t,1),e.debind(),e.parentContainer=null}}function D(e){for(var t in this)this[t]instanceof T&&(this[t]=new this[t].constructor(this[t]));this.actions={};for(var t in e){var n=this[t];n instanceof T||n instanceof C?E(e[t],n):this[t]=e[t]}}function V(e,t){var n=A(e);return n.event={shiftKey:t.shiftKey,altKey:t.altKey,which:t.which,target:t.target,targetViewItem:s(t.target),preventDefault:u(t.preventDefault,t),stopPropagation:u(t.stopPropagation,t)},n}function K(e,t){return e.gaffa.events.on(t,e.renderedElement,function(n){l(e.actions[t],e,V(e,n),n)})}function q(){var e=this;e._removeHandlers=[],e.behaviours=e.behaviours||[]}function I(){}function H(){}function F(){}function W(){}function M(){}function J(){this.views=this.views||{},this.views.content=new C(this.views.content)}function R(){}function G(){}function U(){function e(e){return e.__gaffaKeys__||function(){for(var t=[];t.length<e.length&&t.push(t.length.toString()););return t}()}function t(n,r,o){if(n.length<2)return n;var i,a,s=e(n),u=n.slice(),c=s.slice(),f=[],p=u.splice(u.length/2,1).pop(),l=c.splice(c.length/2,1).pop(),h=[];f.__gaffaKeys__=[],h.__gaffaKeys__=[];for(var d=0;d<u.length;d++){var v=u[d];r.callWith(o,[v,p])>0?(h.push(v),h.__gaffaKeys__.push(c[d])):(f.push(v),f.__gaffaKeys__.push(c[d]))}return f=t(f,r,o),f.push(p),f.__gaffaKeys__.push(l),h=t(h,r,o),a=f.__gaffaKeys__.concat(h.__gaffaKeys__),i=f.concat(h),i.__gaffaKeys__=a,i}function i(e){return Array.isArray(e)?(r(e,i),void 0):(e.gaffa=N,e.parentContainer=P,e.bind(),P.push(e),void 0)}function u(e,t){j[e]=j[e]||[],j[e].push(t)}function c(e,t){var n=e.split(".");r(n,function(e,o){var i=n.slice(0,o+1).join(".");j[i]&&r(j[i],function(e){e(t)})})}function p(){var e=o(window.location.search);for(var t in e)e.hasOwnProperty(t)&&(e[t]?N.model.set(t,e[t]):N.model.set(t,null))}function h(e,t){var n=N.views;if(t){var o=t.split("."),i=o[0],a=o[1];n=N.namedViews[i].views[a]}for(;E.length;)clearInterval(E.pop());e.views&&n.empty(),e.model&&(A.set({}),N.model.set(e.model,null,null,!1)),e.views&&(r(e.views,function(t,n){e.views[n]=m(t,N)}),n.add(e.views)),e.behaviours&&(r(e.behaviours,function(t,n){e.behaviours[n]=b(t,N)}),N.behaviours.add(e.behaviours)),p()}function d(e,t,n,r){function o(r){var o;r.target=t,void 0!==r&&null!==r&&r.title&&(o=r.title),n!==!1&&N.pushState(r,o,e),K[e]=JSON.stringify(r),h(r,t),N.notifications.notify("navigation.success"),window.scrollTo(0,0)}function i(e){N.notifications.notify("navigation.error",e)}function a(){N.notifications.notify("navigation.complete")}return N.notifications.notify("navigation.begin"),N.cacheNavigates!==!1&&K[e]?(o(JSON.parse(K[e])),a(),void 0):(N.ajax({headers:{"x-gaffa":"navigate"},cache:"Microsoft Internet Explorer"!==navigator.appName,url:e,type:"get",data:r,dataType:"json",success:o,error:i,complete:a}),void 0)}function w(e){e.windowLocation=window.location.toString()}var A,N={};window.addEventListener("DOMContentLoaded",function(){document.body.gaffa=N});var k={},S=[],P=[],j={},E=[];A=new B(k),N.gedi=A;var O=A.gel.scope.filter;A.gel.scope.filter=function(t,n){if(!t.get("__trackKeys__"))return O(t,n);var o,n=n.all(),i=[],a=n[0],s=n[1];return a?(o=e(a),i.__gaffaKeys__=[],n.length<2?n:Array.isArray(a)?(r(a,function(e,n){"function"==typeof s?t.callWith(s,[e])&&(i.push(e),i.__gaffaKeys__.push(o[n])):e===s&&(i.push(e),i.__gaffaKeys__.push(o[n]))}),i):void 0):void 0};var L=A.gel.scope.slice;A.gel.scope.slice=function(t,n){if(!t.get("__trackKeys__"))return L(t,n);var r,o,i,a,s=n.next();return n.hasNext()&&(r=s,s=n.next()),n.hasNext()&&(o=s,s=n.next()),Array.isArray(s)?(a=e(s),i=s.slice(r,o),i.__gaffaKeys__=a.slice(r,o),i):void 0};var V=A.gel.scope.sort;A.gel.scope.sort=function(e,n){if(!e.get("__trackKeys__"))return V(e,n);var r,o=n.next(),i=n.next();if(Array.isArray(o))return r=t(o,e,i)};var K={};return N.onpopstate=function(e){e.state&&d(window.location.toString(),e.state.target,!1)},window.onpopstate=N.onpopstate,v(N,{addDefaultStyle:g,createSpec:n,jsonConverter:x,Path:A.Path,ViewItem:D,View:q,ContainerView:J,Action:R,Behaviour:G,Property:T,ViewContainer:C,initialiseViewItem:y,events:{on:function(e,t,n){return"on"+e.toLowerCase()in t?X.on(e,t,n):void 0}},model:{get:function(e,t,n){t instanceof D||t instanceof T||(n=t,t=void 0);var r;return t&&t.getPath&&(r=t.getPath()),n=n||{},w(n),A.get(e,r,n)},set:function(e,t,n,r){var o;null!=e&&(n&&n.getPath&&(o=n.getPath()),A.set(e,t,o,r))},remove:function(e,t,n){var r;null!=e&&(t&&t.getPath&&(r=t.getPath()),A.remove(e,r,n))},bind:function(e,t,n){var r;n&&n.getPath&&(r=n.getPath()),n.gediCallbacks||(n.gediCallbacks=[]),n.gediCallbacks.push(function(){A.debind(t)}),A.bind(e,t,r)},debind:function(e){for(;e.gediCallbacks&&e.gediCallbacks.length;)e.gediCallbacks.pop()()},isDirty:function(e,t){var n;if(null!=e)return t&&t.getPath&&(n=t.getPath()),A.isDirty(e,n)},setDirtyState:function(e,t,n){var r;null!=e&&(n&&n.getPath&&(r=n.getPath()),A.setDirtyState(e,t,r))}},views:{insertTarget:null,add:function(e,t){return Array.isArray(e)?(r(e,N.views.add),void 0):(e.name&&(N.namedViews[e.name]=viewItem),e.gaffa=N,e.parentContainer=S,e.render(),e.bind(),e.insert(S,t),void 0)},remove:_,empty:function(){_(S)},constructors:{}},namedViews:{},actions:{trigger:l,constructors:{}},behaviours:{add:i,constructors:{}},utils:{getProp:function(e,t){for(var n=t.split(U.pathSeparator).reverse();n.length;){var r=n.pop();if(void 0===e[r]||null===e[r])return;e=e[r]}return e},propExists:function(e,t){for(var n=t.split(".").reverse();n.length;){var r=n.pop();if(void 0===e[r]||null===e[r])return!1;e=e[r]}return!0},deDom:f},navigate:d,notifications:{add:u,notify:c},load:function(e,t){var n;void 0!==e&&null!==e&&e.title&&(n=e.title),t&&N.pushState(e,n,document.location),h(e)},queryStringToModel:p,extend:v,clone:function(e){return null!=e&&"object"==typeof e?Array.isArray(e)?e.slice():e instanceof Date?new Date(e):v({},e):e},ajax:a,crel:z,doc:X,fastEach:r,getClosestItem:s,pushState:function(e,t,n){window.history.pushState(e,t,n)}}),N}var $,B=e("gedi"),X=e("doc-js"),z=e("crel"),r=e("fasteach"),Z=e("deep-equal"),Q=e("./raf.js"),Y=Q.requestAnimationFrame,et=Q.cancelAnimationFrame;Object.create=Object.create||function(e){function t(){}if(arguments.length>1)throw new Error("Object.create implementation only accepts the first parameter.");return t.prototype=e,new t},Array.prototype.indexOf=Array.prototype.indexOf||function(e){r(this,function(t,n){return t===e?n:void 0})},String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},Array.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},String.prototype.format=function(e){return this.replace(/{(\d+)}/g,function(t,n){return void 0==e[n]||null==e[n]?t:e[n]}).replace(/{(\d+)}/g,"")},String.prototype.deformat=function(e){for(var t,n=/{(\d+)}/g,r=[],o=0;null!=(t=n.exec(e));)r[o]=parseInt(t[1]),o++;var i=new RegExp("^"+e.replace(/[-[\]()*+?.,\\^$|#\s]/g,"\\$&").replace(/(\{\d+\})/g,"(.*?)")+"$","g"),a=i.exec(this);if(!a)return!1;for(var s=[],u=0;u<r.length;u++)s.push(a[r[u]+1]);return s},T=n(T),T.prototype.set=function(e,t){var n=this.gaffa;null==t&&(t=!0),this.value=e,this.binding&&(this._previousHash=P(e),n.model.set(this.binding,this.setTransform?n.model.get(this.setTransform,this,{value:e}):e,this)),t&&this.update&&this.update(this.parent,e)},T.prototype.sameAsPrevious=function(){return j(this.value,this._previousHash)?!0:(this._previousHash=P(this.value),void 0)},T.prototype.setPreviousHash=function(e){this._previousHash=e},T.prototype.getPreviousHash=function(){return this._previousHash},T.prototype.bind=S,T.prototype.debind=function(){this.gaffa&&this.gaffa.model.debind(this)},T.prototype.getPath=function(){return d(this)},T.prototype.toJSON=function(){var e=x(this,["_previousHash"]);return e},C=n(C,Array),C.prototype.bind=function(e){if(this.parent=e,this.gaffa=e.gaffa,!this.bound){this.bound=!0;for(var t in this)this[t]instanceof T&&this[t].bind(this);return this}},C.prototype.debind=function(){if(this.bound){this.bound=!1;for(var e=0;e<this.length;e++)this[e].debind()}},C.prototype.getPath=function(){return d(this)},C.prototype.add=function(e,t){if(Array.isArray(e)){for(var n=0;n<e.length;n++)this.add(e[n]);return this}return this.splice(null!=t?t:this.length,0,e),e.parentContainer=this,this.bound&&this.render.update(this,this.render.value),this},C.prototype.remove=function(e){e.remove()},C.prototype.empty=function(){_(this)},C.prototype.toJSON=function(){return x(this,["element"])},C.prototype.render=new T({update:function(e,t){var n=0,r=e.length;if(t)for(;r>n;n++){var o=e[n];o.gaffa=e.gaffa,o.renderedElement||(o.name&&(e.gaffa.namedViews[o.name]=o),o.render(),o.bind(e.parent),o.insert(e,n))}else for(;r>n;n++)e[n].debind()},value:!0}),D=n(D),D.prototype.path="[]",D.prototype.bind=function(e){var t=this;this.parent=e,this.bound=!0;for(var n in this.constructor.prototype)if(this[n]instanceof T){var r=this[n];r.gaffa=t.gaffa,r.bind(this)}},D.prototype.debind=function(){O(this)},D.prototype.remove=function(){L(this)},D.prototype.getPath=function(){return d(this)},D.prototype.toJSON=function(){return x(this)},q=n(q,D),q.prototype.bind=function(){D.prototype.bind.apply(this,arguments);for(var e=0;e<this.behaviours.length;e++)this.behaviours[e].gaffa=this.gaffa,this.behaviours[e].bind(this);for(var t in this.actions){var n,r=this.actions[t];r._bound||(r._bound=!0,n=K(this,t),n&&this._removeHandlers.push(n))}},q.prototype.detach=function(){this.renderedElement&&this.renderedElement.parentNode&&this.renderedElement.parentNode.removeChild(this.renderedElement)},q.prototype.remove=function(){this.detach(),L(this)},q.prototype.debind=function(){for(var e=0;e<this.behaviours.length;e++)this.behaviours[e].debind();for(;this._removeHandlers.length;)this._removeHandlers.pop()();O(this)},q.prototype.render=function(){this.renderedElement.viewModel=this},q.prototype.insert=function(e,t){var n=this,r=n.gaffa;n.afterInsert&&X.on("DOMNodeInserted",document,function(e){X.closest(n.renderedElement,e.target)&&n.afterInsert()});var o=this.renderTarget||e&&e.element||r.views.renderTarget||"body";this.insertFunction(this.insertSelector||o,this.renderedElement,t)},I=n(I,T),I.prototype.update=function(e,t){"internalClassNames"in e.classes||(e.classes.internalClassNames=e.renderedElement.className);var n=e.classes.internalClassNames,r=[n,t].join(" ").trim();e.renderedElement.className=r?r:null},q.prototype.classes=new I,H=n(H,T),H.prototype.value=!0,H.prototype.update=function(e,t){e.renderedElement.style.display=t?null:"none"},q.prototype.visible=new H,F=n(F,T),F.prototype.value=!0,F.prototype.update=function(e,t){!t!=!!e.renderedElement.disabled&&e.renderedElement[t?"removeAttribute":"setAttribute"]("disabled","disabled")},q.prototype.enabled=new F,W=n(W,T),W.prototype.update=function(e,t){e.renderedElement[t?"setAttribute":"removeAttribute"]("title",t)},q.prototype.title=new W,M=n(M,T),M.prototype.update=function(e,t){if("value"in this)for(var n in e.views)e.views[n].render.value=t},q.prototype.renderChildren=new M,q.prototype.insertFunction=h,J=n(J,q),J.prototype.bind=function(){q.prototype.bind.apply(this,arguments);for(var e in this.views){var t=this.views[e];t instanceof C&&t.bind(this)}},J.prototype.debind=function(){q.prototype.debind.apply(this,arguments);for(var e in this.views){var t=this.views[e];t instanceof C&&t.debind()}},J.prototype.remove=function(){q.prototype.remove.apply(this,arguments);for(var e in this.views){var t=this.views[e];t instanceof C&&t.empty()}},R=n(R,D),R.prototype.bind=function(){D.prototype.bind.call(this)},R.prototype.trigger=function(e,t){this.parent=e,t=t||{};var n=this.gaffa=e.gaffa,r=t.__trackKeys__;for(var o in this.constructor.prototype){var i=this[o];i instanceof T&&i.binding&&(i.gaffa=n,i.parent=this,t.__trackKeys__=i.trackKeys,i.value=n.model.get(i.binding,this,t))}t.__trackKeys__=r,this.debind()},G=n(G,D),G.prototype.toJSON=function(){return x(this)},U.pathSeparator="/",U.Property=T,U.ViewContainer=C,U.ViewItem=D,U.View=q,U.ContainerView=J,U.Action=R,U.createSpec=n,U.Behaviour=G,U.addDefaultStyle=g,U.propertyUpdaters={collection:function(e,t,n,r){return function(o,i){var a=this,s=o.views[e],u=a.keys;if(i&&"object"==typeof i){var c=o.renderedElement;if(c&&a.template){for(var f,p=!0,l=0;l<s.length;l++){var h=s[l],d=h.key;(!u||u.indexOf(d)>=0)&&i[h.key]||h.containerName!==e||(l--,n(o,i,h),h.remove())}var v=0;for(var g in i)if(!Array.isArray(i)||!isNaN(g)){p=!1;for(var y=!1,l=0;l<s.length;l++){var m=s[l],w=g;u&&(w=u[g]),m.key===w&&(y=m)}if(!y){var b=g;u&&(b=u[g]),f={key:b,containerName:e},t(o,i,f,v)}v++}r(o,p)}}else{for(var l=0;l<s.length;l++){var h=s[l];h.containerName===e&&(l--,n(o,i,h),h.remove())}r(o,!0)}}},group:function(e,t,n,o){return function(i,a){var s,u,f=this,p=f.gaffa,l=i.views[e],h=f.previousGroups;if(a&&"object"==typeof a){if(i.distinctGroups=c(p,f.value,f.expression),h){if(h.length===i.distinctGroups.length)return;var d=!0;if(r(h,function(e){e!==i.distinctGroups[e]&&(d=!1)}),d)return}f.previousGroups=i.distinctGroups;for(var v=0;v<l.length;v++){var g=l[v];i.distinctGroups.indexOf(g.group)<0&&(l.splice(v,1),v--,n(i,a,g))}r(i.distinctGroups,function(e){var n=!1;r(l,function(t){t.group===e&&(n=!0)}),n||(s={group:e},t(i,a,s))}),u=!l.length,o(i,u)}else r(l,function(e,t){l.splice(t,1),n(i,f.value,e)})}}},t.exports=U}()},{"./raf.js":29,"doc-js":30,gedi:31,crel:32,"deep-equal":33,fasteach:34}],30:[function(e,t,n){!function(e,r){"object"==typeof n?t.exports=r():"function"==typeof define&&define.amd?define(r):e.doc=r()}(this,function(){function e(e){return"string"==typeof e}function t(t){return e(t)?r.find(t)[0]:t}function n(e){t(e.target).addEventListener(e.event,e.callback,!1)}var r={},o=this.window,i=o&&o.document;return r.find=function(e,n){return null==n&&(n=e,e=i),e=t(e),e?e.querySelectorAll(n):[]},r.closest=function(e,n){for(e=t(e);e&&e.ownerDocument&&!r.is(e,n);)e=e.parentNode;return e===i&&e!==n?null:e},r.is=function(e,n){return e=t(e),e.ownerDocument&&"string"==typeof n?e===n||Array.prototype.slice.call(r.find(e.parentNode,n)).indexOf(e)>=0:e===n},r.addClass=function(e,n){e=t(e);for(var n=n.split(" "),r=e.className.split(" "),o=0;o<n.length;o++){var i=n[o];i&&" "!==i&&(e.classList?e.classList.add(i):!r.indexOf(i)>=0&&r.push(i))}return e.classList||(e.className=r.join(" ")),this},r.removeClass=function(e,n){e=t(e);for(var n=n.split(" "),r=e.className.split(" "),o=0;o<n.length;o++){var i=n[o];if(i&&" "!==i)if(e.classList)e.classList.remove(i);else{var a=r.indexOf(i);a>=0&&r.splice(a,1)}}return e.classList||(e.className=r.join(" ")),this},r.on=function(e,o,a,s){var u=[];"string"==typeof e&&(e=e.split(" "));for(var c=0;c<e.length;c++){var f={};s?(s===!0&&(s=i),f.target=s,f.callback=function(e){var t=r.closest(e.target,o);t&&a(e,t)}):(f.target=o,f.callback=a),f.event=e[c],n(f),u.push(f)}return function(){for(;u.length;){var e=u.pop();t(e.target).removeEventListener(e.event,e.callback)}}},r.off=function(e,n,r,o){"string"==typeof e&&(e=e.split(" ")),"function"!=typeof r&&(o=r,r=null),o=o?t(o):i;for(var a=find(n,o),s=0;s<a.length;s++)for(var u=a[s],c=0;c<e.length;c++)u.removeEventListener(e[c],r)},r.isVisible=function(e){for(;e.parentNode&&"none"!==e.style.display;)e=e.parentNode;return e===i},r})},{}],32:[function(e,t,n){!function(e,r){"object"==typeof n?t.exports=r():"function"==typeof define&&define.amd?define(r):e.crel=r()}(this,function(){function e(){var n,r=window.document,o=arguments,i=r.createElement(o[0]),a=o[1],s=2,u=o.length,c=e.attrMap;if(1===u)return i;if(("object"!=typeof a||t(a))&&(--s,a=null),1===u-s&&"string"==typeof o[s]&&void 0!==i.textContent)i.textContent=o[s];else for(;u>s;++s)n=o[s],null!=n&&(t(n)||(n=r.createTextNode(n)),i.appendChild(n));for(var f in a)if(c[f]){var p=e.attrMap[f];"function"==typeof p?p(i,a[f]):i.setAttribute(p,a[f])}else i.setAttribute(f,a[f]);return i}var t="object"==typeof Node?function(e){return e instanceof Node}:function(e){return e&&"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName};return e.attrMap={},e.isNode=t,e})},{}],33:[function(e,t){function n(e){return null===e||void 0===e}function r(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function o(e,t){if(n(e)||n(t))return!1;if(e.prototype!==t.prototype)return!1;if(r(e))return r(t)?(e=i.call(e),t=i.call(t),s(e,t)):!1;try{var o,u,c=a(e),f=a(t)}catch(p){return!1}if(c.length!=f.length)return!1;for(c.sort(),f.sort(),u=c.length-1;u>=0;u--)if(c[u]!=f[u])return!1;for(u=c.length-1;u>=0;u--)if(o=c[u],!s(e[o],t[o]))return!1;return!0}var i=Array.prototype.slice,a="function"==typeof Object.keys?Object.keys:function(e){var t=[];for(var n in e)t.push(n);return t},s=t.exports=function(e,t){return e===t?!0:e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():"object"!=typeof e&&"object"!=typeof t?e==t:o(e,t)}},{}],34:[function(e,t){function n(e,t){for(var n=0;n<e.length&&!t(e[n],n,e);n++);return e}t.exports=n},{}],6:[function(e,t){function n(){}var r=e("gaffa");n=r.createSpec(n,r.ContainerView),n.prototype.type="container",n.prototype.render=function(){this.views.content.element=this.renderedElement=document.createElement(this.tagName||"div"),this.__super__.render.apply(this,arguments)},t.exports=n},{gaffa:5}],7:[function(e,t){function n(){this.views.list=new o.ViewContainer(this.views.list),this.views.empty=new o.ViewContainer(this.views.empty)}function r(e,t,n){e.templateCache||(e.templateCache={});var r=JSON.parse(e.templateCache[t]||(e.templateCache[t]=JSON.stringify(e[t])));for(var o in n)r[o]=n[o];return e.gaffa.initialiseViewItem(r,e.gaffa,e.gaffa.views.constructors)}var o=e("gaffa"),i=e("crel"),a="list";n=o.createSpec(n,o.ContainerView),n.prototype.type=a,n.prototype.render=function(){var e=i(this.tagName||"div");this.views.list.element=e,this.views.empty.element=e,this.renderedElement=e,this.__super__.render.apply(this,arguments)},n.prototype.list=new o.Property({update:o.propertyUpdaters.collection("list",function(e,t,n,o){var i=e.views.list,a=e.list;i.add(r(a,"template",n),o)},function(e,t,n){n.remove()},function(e,t){var n=e.views.empty,o=e.list;if(o.emptyTemplate)if(t)n.length||n.add(r(o,"emptyTemplate"));else for(;n.length;)n[0].remove()}),trackKeys:!0,sameAsPrevious:function(){var e=this.getPreviousHash(),t=this.value,n=t&&(t.__gaffaKeys__||Object.keys(t));if(this.setPreviousHash(n||t),n&&e&&e.length){if(e.length!==n.length)return;for(var r=0;r<n.length;r++)if(n[r]!==e[r])return;return!0}return t===e}}),t.exports=n},{crel:32,gaffa:5}],8:[function(e,t){"use strict";function n(){}var r=e("gaffa"),o=e("crel"),i="heading";n=r.createSpec(n,r.View),n.prototype.type=i,n.prototype.render=function(){var e=document.createTextNode(""),t=o("h"+(parseInt(this.level)||1),e);this.renderedElement=t,this.text.textNode=e,this.__super__.render.apply(this,arguments)},n.prototype.text=new r.Property(function(e,t){this.textNode.textContent=null!==t&&void 0!==t?t:""}),t.exports=n},{crel:32,gaffa:5}],9:[function(e,t){function n(){this.views.groups=new o.ViewContainer(this.views.groups),this.views.empty=new o.ViewContainer(this.views.empty)
}function r(e,t,n){e.templateCache||(e.templateCache={});var r=JSON.parse(e.templateCache[t]||(e.templateCache[t]=JSON.stringify(e[t])));for(var o in n)r[o]=n[o];return e.gaffa.initialiseViewItem(r,e.gaffa,e.gaffa.views.constructors)}var o=e("gaffa"),i=e("crel"),a="group";n=o.createSpec(n,o.ContainerView),n.prototype.type=a,n.prototype.render=function(){var e=i("div");this.views.groups.element=e,this.views.empty.element=e,this.renderedElement=e,this.__super__.render.apply(this,arguments)},n.prototype.groups=new o.Property({update:o.propertyUpdaters.group("groups",function(e,t,n){var o,i,a=e.views.groups,s=e.groups,u=r(s,"groupTemplate");for(var c in n)u[c]=n[c];s.listTemplate&&(o="({items "+s.listTemplate.list.binding+"}(filter [] {item (= ("+s.expression+' item) "'+n.group+'")}))',i=r(s,"listTemplate",n),i.list.binding=o,u.views.content.add(i)),a.add(u)},function(e,t,n){n.remove()},function(e,t){var n=e.views.empty,o=e.groups;if(o.emptyTemplate)if(t)n.length||n.add(r(o,"emptyTemplate"));else for(;n.length;)n[0].remove()}),trackKeys:!0}),t.exports=n},{crel:32,gaffa:5}],10:[function(e,t){function n(){}var r=e("gaffa"),o="form",i=e("crel");n=r.createSpec(n,r.ContainerView),n.prototype.type=o,n.prototype.render=function(){var e=this,t=i("form");this.action?t.setAttribute("action",this.action):t.addEventListener("submit",function(t){e.actions.submit&&t.preventDefault()}),this.method&&t.setAttribute("method",this.method),this.views.content.element=t,this.renderedElement=t,this.__super__.render.apply(this,arguments)},t.exports=n},{crel:32,gaffa:5}],11:[function(e,t){"use strict";function n(){}var r=e("gaffa"),o=e("crel"),i="label";n=r.createSpec(n,r.View),n.prototype.type=i,n.prototype.render=function(){var e=document.createTextNode(""),t=o(this.tagName||"label",e);this.renderedElement=t,this.text.textNode=e,this.__super__.render.apply(this,arguments)},n.prototype.text=new r.Property(function(e,t){this.textNode.textContent=null!==t&&void 0!==t?t:""}),n.prototype.labelFor=new r.Property(function(e,t){null===t||void 0===t?e.renderedElement.removeAttribute("labelFor"):e.renderedElement.setAttribute("labelFor",t)}),t.exports=n},{crel:32,gaffa:5}],13:[function(e,t){"use strict";function n(){}var r=e("gaffa"),o=e("crel"),i="button";n=r.createSpec(n,r.ContainerView),n.prototype.type=i,n.prototype.render=function(){var e=document.createTextNode(""),t=o("button",e);this.views.content.element=t,this.text.textNode=e,this.renderedElement=t,this.__super__.render.apply(this,arguments)},n.prototype.text=new r.Property(function(e,t){this.textNode.textContent=null!==t&&void 0!==t?t:""}),n.prototype.subType=new r.Property(function(e,t){e.renderedElement.setAttribute("type",t||"button")}),n.prototype.disabled=new r.Property(function(e,t){t?e.renderedElement.setAttribute("disabled","disabled"):e.renderedElement.removeAttribute("disabled")}),t.exports=n},{crel:32,gaffa:5}],12:[function(e,t){function n(){}var r=e("gaffa"),o=(e("crel"),"text");n=r.createSpec(n,r.View),n.prototype.type=o,n.prototype.render=function(){this.renderedElement=document.createTextNode(""),this.__super__.render.apply(this,arguments)},n.prototype.text=new r.Property(function(e,t){e.renderedElement.data=t||""}),n.prototype.visible=new r.Property(function(e,t){e.renderedElement.data=t===!1?"":e.text.value||""}),n.prototype.title=void 0,n.prototype.enabled=void 0,n.prototype.classes=void 0,t.exports=n},{crel:32,gaffa:5}],14:[function(e,t){"use strict";function n(){}var r=e("gaffa"),o=e("crel"),i="anchor";n=r.createSpec(n,r.ContainerView),n.prototype.type=i,n.prototype.render=function(){var e=document.createTextNode(""),t=o("a",e),n=this;this.views.content.element=t,this.renderedElement=t,this.text.textNode=e,this.external||(t.onclick=function(e){e.preventDefault()},this.gaffa.events.on("click",t,function(){n.gaffa.navigate(n.href.value,n.target.value)})),this.__super__.render.apply(this,arguments)},n.prototype.text=new r.Property(function(e,t){this.textNode.textContent=null!==t&&void 0!==t?t:""}),n.prototype.target=new r.Property(function(e,t){"string"==typeof t?e.renderedElement.setAttribute("target",t):e.renderedElement.removeAttribute("target")}),n.prototype.href=new r.Property(function(e,t){null!==t&&void 0!==t?e.renderedElement.setAttribute("href",t):e.renderedElement.removeAttribute("href")}),t.exports=n},{crel:32,gaffa:5}],15:[function(e,t){function n(e,t){var n=new window.FileReader;n.onload=function(e){t(e.target.result)},n.readAsDataURL(e)}function r(){}var o=e("gaffa"),i="image",a=e("crel");r=o.createSpec(r,o.View),r.prototype.type=i,r.prototype.render=function(){var e=a("img");this.renderedElement=e,this.__super__.render.apply(this,arguments)},r.prototype.source=new o.Property(function(e,t){e.renderedElement[t?"setAttribute":"removeAttribute"]("src",t)}),r.prototype.image=new o.Property(function(e,t){t&&("string"==typeof t?e.renderedElement.setAttribute("src",t):n(t,function(t){e.renderedElement.setAttribute("src",t)}))}),t.exports=r},{crel:32,gaffa:5}],16:[function(e,t){"use strict";function n(){}var r=e("gaffa"),o=e("crel"),i="html";n=r.createSpec(n,r.View),n.prototype.type=i,n.prototype.render=function(){var e=o("span");this.renderedElement=e,this.__super__.render.apply(this,arguments)},n.prototype.html=new r.Property(function(e,t){e.renderedElement.innerHTML="string"==typeof t||"number"==typeof t?t:null}),t.exports=n},{crel:32,gaffa:5}],17:[function(e,t){function n(e){var t=e.target,n=t.viewModel;"number"===n.subType.value?n.value.set(parseFloat(t.value),!1):n.value.set(t.value,!1)}function r(e,t){t=t||"";var n=e.renderedElement,r=0,o=n===document.activeElement;if(t!==n.value){if(o)if(window.document.selection){var i=window.document.selection.createRange();i.moveStart("character",-n.value.length),r=i.text.length}else(n.selectionStart||"0"==n.selectionStart)&&(r=n.selectionStart);if(n.value=t,o){if(n.createTextRange){var a=n.createTextRange();a.move("character",r),a.select()}n.selectionStart&&n.setSelectionRange(r,r)}}}function o(e,t){e.renderedElement.setAttribute("type",null!=t?t:"")}function i(e,t){e.renderedElement.setAttribute("placeholder",null!=t?t:"")}function a(e,t){t?e.renderedElement.setAttribute("disabled","disabled"):e.renderedElement.removeAttribute("disabled")}function s(e,t){t?e.renderedElement.setAttribute("required","required"):e.renderedElement.removeAttribute("required")}function u(){}var c=e("gaffa"),f=e("crel"),p="textbox";e("fasteach"),e("doc-js"),u=c.createSpec(u,c.View),u.prototype.type=p,u.prototype.render=function(){var e=f("input");(this.updateEventName||"change").split(" "),this._removeHandlers.push(this.gaffa.events.on(this.updateEventName||"change",e,n)),this.renderedElement=e,this.__super__.render.apply(this,arguments)},u.prototype.value=new c.Property(r),u.prototype.subType=new c.Property(o),u.prototype.placeholder=new c.Property(i),u.prototype.disabled=new c.Property(a),u.prototype.required=new c.Property(s),t.exports=u},{crel:32,"doc-js":30,fasteach:34,gaffa:5}],18:[function(e,t){"use strict";function n(){}var r=e("gaffa"),o=e("crel");n=r.createSpec(n,r.ContainerView),n.prototype.type="checkbox",n.prototype.render=function(){var e,t,n=this,r=o("span",e=o("label"),t=o("input",{type:"checkbox"}));this.checkboxInput=t,this.checkboxLabel=e,t.addEventListener(this.updateEventName||"change",function(){n.checked.set(this.checked)}),e.addEventListener("click",function(){t.click()}),r.appendChild(t),r.appendChild(e),this.views.content.element=e,this.renderedElement=r,this.__super__.render.apply(this,arguments)},n.prototype.checked=new r.Property(function(e,t){e.checkboxInput.checked=t}),n.prototype.text=new r.Property(function(e,t){e.checkboxLabel.textContent=t&&"string"==typeof t?t:null}),n.prototype.showLabel=new r.Property(function(e,t){e.checkboxLabel.style.display=t===!1?"none":null}),t.exports=n},{crel:32,gaffa:5}],19:[function(e,t){function n(){}var r=e("gaffa"),o="set";n=r.createSpec(n,r.Action),n.prototype.type=o,n.prototype.trigger=function(){this.__super__.trigger.apply(this,arguments);var e=this.source.value;this.clone&&this.clone.value===!1||(e=this.gaffa.clone(e)),this.target.set(e,this.cleans.value?!1:null)},n.prototype.target=new r.Property,n.prototype.source=new r.Property,n.prototype.clone=new r.Property,n.prototype.cleans=new r.Property,t.exports=n},{gaffa:5}],20:[function(e,t){function n(){}var r=e("gaffa"),o="ajax";n=r.createSpec(n,r.Action),n.prototype.type=o,n.prototype.method=new r.Property({value:"GET"}),n.prototype.auth=new r.Property,n.prototype.dataType="json",n.prototype.trigger=function(e,t,n){this.__super__.trigger.apply(this,arguments);var r=this,o=this.gaffa,i=r.source.value,a=function(e){o.actions.trigger(r.actions.error,r,t,n),o.notifications.notify("store.error."+r.kind,e)};if(o.notifications.notify("store.begin."+r.kind),"formData"===r.dataType){var s=new FormData;for(var u in i)i.hasOwnProperty(u)&&null!=i[u]&&s.append(u,i[u]);i=s}var c={cache:r.cache,type:r.method.value,url:r.url.value||window.location.pathname,data:i,dataType:r.dataType,auth:r.auth.value,contentType:r.contentType,success:function(e){return o.responseIsError&&o.responseIsError(e)?(a(e),void 0):(r.target.set(e),r.cleans!==!1&&r.target.binding&&o.model.setDirtyState(r.target.binding,!1,r),t=t||{},t.data=e,o.actions.trigger(r.actions.success,r,t,n),o.notifications.notify("store.success."+r.kind),void 0)},error:a,complete:function(){o.actions.trigger(r.actions.complete,r,t,n),o.notifications.notify("store.complete."+r.kind)}};"file"===r.dataType&&(i=new FormData,i.append("file",r.source.value),c.contentType=!1,c.processData=!1,c.data=i,dataType=!1),o.ajax(c)},n.prototype.target=new r.Property,n.prototype.source=new r.Property,n.prototype.dirty=new r.Property,n.prototype.url=new r.Property,t.exports=n},{gaffa:5}],21:[function(e,t){function n(){}var r=e("gaffa"),o="remove";n=r.createSpec(n,r.Action),n.prototype.type=o,n.prototype.trigger=function(){this.__super__.trigger.apply(this,arguments),this.gaffa.model.remove(this.target.binding,this,this.cleans.value?!1:null)},n.prototype.target=new r.Property,n.prototype.cleans=new r.Property,t.exports=n},{gaffa:5}],22:[function(e,t){function n(){}var r=e("gaffa"),o="push";n=r.createSpec(n,r.Action),n.prototype.type=o,n.prototype.trigger=function(){this.__super__.trigger.apply(this,arguments);var e=this.target.value;if(null==e&&(e=[],this.target.set(e)),!Array.isArray(e))throw"Attempted to push to model property that was not an array, null, or undefined";var t=this.source.value;this.clone&&this.clone.value===!1||(t=this.gaffa.clone(t));var n=this.gaffa.gedi.paths.append(this.target.binding,this.gaffa.gedi.paths.create(e.length.toString()));this.gaffa.model.set(n,t,this,this.cleans.value?!1:null)},n.prototype.target=new r.Property,n.prototype.source=new r.Property,n.prototype.cleans=new r.Property,t.exports=n},{gaffa:5}],23:[function(e,t){function n(){}var r=e("gaffa"),o="toggle";n=r.createSpec(n,r.Action),n.prototype.type=o,n.prototype.trigger=function(){this.__super__.trigger.apply(this,arguments),this.target.set(!this.target.value,this)},n.prototype.target=new r.Property,t.exports=n},{gaffa:5}],24:[function(e,t){function n(){}var r=e("gaffa"),o="conditional";n=r.createSpec(n,r.Action),n.prototype.type=o,n.prototype.condition=new r.Property,n.prototype.trigger=function(e,t,n){this.__super__.trigger.apply(this,arguments),this.condition.value?this.gaffa.actions.trigger(this.actions["true"],this,t,n):this.gaffa.actions.trigger(this.actions["false"],this,t,n)},t.exports=n},{gaffa:5}],25:[function(e,t){function n(){}function r(){}var o=e("gaffa"),i="forEach";n=o.createSpec(n,o.Action),n.prototype.type=i,n.prototype.target=new o.Property({trackKeys:!0}),n.prototype.trigger=function(e,t,n){this.__super__.trigger.apply(this,arguments);var o=this.target.value;if(o)for(var i=o.__gaffaKeys__,a=0;a<o.length;a++){var s=new r;s.gaffa=this.gaffa,s.path=this.getPath(),s.key=i?i[a]:""+a;var u=JSON.parse(JSON.stringify(this.actions.forEach));s.actions.all=u,s=this.gaffa.initialiseViewItem(s,s.gaffa,s.actions.constructors),this.gaffa.actions.trigger(s.actions.all,s,t,n)}},r=o.createSpec(r,o.Action),r.prototype.type="eachPsudoParent",t.exports=n},{gaffa:5}],26:[function(e,t){function n(){}var r=e("gaffa"),o="browserStorage";n=r.createSpec(n,r.Action),n.prototype.type=o,n.prototype.trigger=function(){this.__super__.trigger.apply(this,arguments);var e=this,t=e.source.value;switch(e.method.value){case"get":t=window[e.storageType.value+"Storage"].getItem(e.source.value),e.target.set(t?JSON.parse(t):void 0);break;case"set":window[e.storageType.value+"Storage"].setItem(e.target.value,JSON.stringify(t))}},n.prototype.storageType=new r.Property({value:"local"}),n.prototype.method=new r.Property({value:"get"}),n.prototype.target=new r.Property,n.prototype.source=new r.Property,t.exports=n},{gaffa:5}],27:[function(e,t){function n(){}var r=e("gaffa"),o="pageLoad";n=r.createSpec(n,r.Behaviour),n.prototype.type=o,n.prototype.bind=function(){r.Behaviour.prototype.bind.apply(this,arguments),this.gaffa.actions.trigger(this.actions.load,this)},t.exports=n},{gaffa:5}],28:[function(e,t){function n(e){e.gaffa.actions.trigger(e.actions.change,e)}function r(){}var o=e("gaffa"),i="modelChange";r=o.createSpec(r,o.Behaviour),r.prototype.type=i,r.prototype.condition=new o.Property({value:!0}),r.prototype.watch=new o.Property({update:function(e,t){if(e.gaffa,e.condition.value){var r=e.throttle;if(isNaN(r))n(e,t);else{var o=new Date;!e.lastTrigger||o-e.lastTrigger>r?(e.lastTrigger=o,n(e,t)):(clearTimeout(e.timeout),e.timeout=setTimeout(function(){e.lastTrigger=o,n(e,t)},r-(o-e.lastTrigger)))}}},sameAsPrevious:function(){var e="object"==typeof this.value||this.getPreviousHash()!==this.value;return this.setPreviousHash(this.value),!e}}),t.exports=r},{gaffa:5}],31:[function(e,t){function n(e){function t(e,t){for(var n=0;n<e.length&&!t(e[n],n,e);n++);return e}function n(e){if("["===e.charAt(0)){var t=1;do{if("\\"===e.charAt(t)&&"\\"===e.charAt(t+1)||"\\"===e.charAt(t)&&("["===e.charAt(t+1)||"]"===e.charAt(t+1)))t++;else if("]"===e.charAt(t)){var n=e.slice(0,t+1);return new u(n,n.length)}t++}while(t<e.length)}}function u(){}function c(e,t){if(!e)return t;var n=D[e.toString()];if(n&&n.model===t)return n.value;if(T(e))return t;var r=S(e),o=t,i=0,a=r.length;for(j(e)&&(i=1);a>i;i++){var s=r[i];if(null==o)break;if("object"!=typeof o[s]){o=o[s],a-1>i&&(o=void 0);break}o=o[s]}return D[e]={model:t,value:o},o}function f(e,t){for(var n in t)delete t[n];for(var r in e)t[r]=e[r]}function p(e,t,n){if(e){D={},"object"==typeof e&&(t=e,e=k);var r=S(e),o=0,i=r.length;if(T(e))return f(t,n),void 0;j(e)&&(o=1);for(var a=n;i>o;o++){var s=r[o];("object"!=typeof a[s]||null===a[s])&&i-1>o&&(a[s]=isNaN(s)?{}:[]),o===i-1?a[s]=t:a=a[s]}}}function l(e,t){var n=t;D={};var r=S(e),o=0,i=r.length;if(T(e))return f({},t),void 0;for(j(e)&&(o=1);i>o;o++){var a=r[o];if("object"!=typeof n[a]&&i-1>o)break;o===i-1?n instanceof Array?n.splice(a,1):delete n[a]:n=n[a]}return n}function h(e){function n(e,r){if(void 0!=e&&null!==e){for(var o=0;o<e.length;o++){var s,u,c=e[o],f=c.binding,p=c.parentPath,l=f.indexOf(i.pathWildcard);l>=0&&g(f)[0]===f&&(s=S(m("[/]",c.parentPath,f)),p=null,t(s,function(e,t){if(e===i.pathWildcard)s[t]=a[t];else if(e!==a[t])return u=!0}),u)||c({target:a,getValue:function(e,t){return w(f,p,e,t)}})}if(r)for(var h in e)e.hasOwnProperty(h)&&Array.isArray(e[h])&&n(e[h],r)}}var r=O,o=[r],a=m("[/]",e),u=0;j(e)&&(u=1);for(var c=S(e);u<c.length;u++){var f=c[u];(!isNaN(f)||f in s)&&(f="_"+f),void 0!==r&&null!==r&&(r=r[f],o.push(r))}for(;o.length>1;)r=o.shift(),n(r);n(o.pop(),!0)}function d(e,n,r){var o,a=O;if(n.binding=n.binding||e,n.parentPath=r,n.references||(n.references=[]),!N(e)){var u=g(e);return t(u,function(e){d(e,n,r)}),void 0}o=e,n.references.push(o),r&&(o=m(k(),r,o));var c=o.indexOf(i.pathWildcard);if(c>=0&&(o=o.slice(0,c)),T(o))return a.push(n),void 0;var f=0;j(o)&&(f=1);for(var p=S(o);f<p.length;f++){var l=p[f];(!isNaN(l)||l in s)&&(l="_"+l),"object"!=typeof a[l]&&f<p.length-1?(a[l]=[],a=a[l]):f===p.length-1?(a[l]=a[l]||[],a[l].push(n)):a=a[l]}}function v(e,n){var r;"function"==typeof e&&(n=e,e=null);var o=n?n.parentPath:null;if(null==e)return null!=n&&n.references?t(n.references,function(e){v(e,n)}):O=[],void 0;var i=g(e);if(i.length>1)return t(i,function(e){v(e,n)}),void 0;for(var a=S(m(o,e)),s=[],u=0;u<a.length;u++)s[u]=parseInt(a[u]).toString()===a[u]?"_"+a[u]:a[u];var f=N(s);if(n||p(f,[],O),r=c(f,O))for(var u=0;u<r.length;u++)if(r[u]===n)return r.splice(u,1),void 0}function g(e){var t=[];if(V[e])return V[e];if(!E)return V[e]=[N(e)];for(var n=E.tokenise(e),r=0;r<n.length;r++){var o=n[r];o instanceof u&&t.push(o.original)}return V[e]=t}function y(e){return i.pathStart+(null==e?"":e)+i.pathEnd}function m(){for(var e="",t=0;t<arguments.length;t++)e+=arguments[t];if(K[e])return K[e];for(var n,r,o,a=[],t=0;t<arguments.length;t++)if(r=S(arguments[t]),r&&r.length)for(var s=0;s<r.length;s++)if(o=r[s],0===r.length);else if(o===i.currentKey)null!=n&&(a.push(n),n=null);else if(o===i.rootPath)a=[""];else if(o===i.upALevel)n=a.pop();else if(o.slice(0,2)===i.upALevel)for(var u=o.slice(2);a.slice(-1).pop()!==u;){if(0===a.length)throw"Named path part was not found: '"+o+"', in path: '"+path+"'.";n=a.pop()}else a.push(o);return K[e]=N(a)}function w(t,n,r,o){if(n&&"string"!=typeof n&&(r=n,n=N()),t&&E){var i=t;return r=r||{},r._gediModelContext_=n,E.evaluate(i,r,o)}return n=n||N(),t=m(n,t),c(t,e)}function b(t,n,r,o){"object"!=typeof t||N(t)?"boolean"==typeof r&&(o=r,r=void 0):(o=n,n=t,t=k()),r=r||N(),t=m(r,t),x(t,o),p(t,n,e),h(t)}function _(t,n,r){n instanceof Boolean&&(r=n,n=void 0),n=n||N(),t=m(n,t),x(t,r);var o=l(t,e);Array.isArray(o)&&(t=m("[/]",P(t,N(i.upALevel)))),h(t)}function x(e,t,n){var r=L;if(!N(e))throw a.invalidPath;if(n=n||N(),t=t!==!1,T(e))return L={_isDirty_:t},void 0;var o=0;j(e)&&(o=1);for(var i=S(m(n,e));o<i.length;o++){var s=i[o];("object"!=typeof r[s]||null===r[s])&&o<i.length-1&&(r[s]={}),o===i.length-1?(r[s]={},r[s]._isDirty_=t):r=r[s]}i.length||(L._isDirty_=t)}function A(e){var t,n=function(e){if("object"!=typeof e)return!1;if(e._isDirty_)return!0;for(var t in e)if(n(e[t]))return!0};return t=c(e,L),!!n(t)}function N(e){if(null==e)return y();if(q[e])return q[e];if("string"==typeof e){if(e.charAt(0)===i.pathStart){var t=e.toString(),r=n(t);return r&&r.length===t.length?q[t]=r.original:!1}return N(y(e))}if(e instanceof Array){for(var o=[],a=0;a<e.length;a++){var s=e[a];s.indexOf("\\")>=0&&(s=s.replace(/([\[|\]|\\|\/])/g,"\\$1")),o.push(s)}return y(o.join(i.pathSeparator))}}function k(){return N([i.rootPath,i.rootPath])}function S(e){if(e){if(Array.isArray(e))return e;e=e.slice(1,-1);var t,n,r,o=0;if(e.indexOf("\\")<0)return""===e?[]:e.split(i.pathSeparator);t=[];for(var a=0;a<e.length;a++)r=e.charAt(a),r===i.pathSeparator?(t.push(e.slice(o,a)),o=a+1):"\\"===r&&(n=e.charAt(a+1),"\\"===n?e=e.slice(0,a)+e.slice(a+1):"]"===n||"["===n?e=e.slice(0,a)+e.slice(a+1):n===i.pathSeparator&&t.push(e.slice(o),a));return t.push(e.slice(o)),t}}function P(){for(var e=S(arguments[0]),t=1;t<arguments.length;t++)for(var n=S(arguments[t]),r=0;r<n.length;r++)e.push(n[r]);return N(e)}function j(e){return S(e)[0]===i.rootPath}function T(e){var t=S(e);return j(t)&&t[0]===t[1]||0===t.length}function C(){}e=e||{};var E,O=[],L={};Array.prototype.indexOf=Array.prototype.indexOf||function(e){t(this,function(t,n){return t===e?n:void 0})},String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},Array.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},E=new r,u=o(u,r.Token),u.prototype.precedence=4,u.tokenise=n,u.prototype.evaluate=function(t){this.result=c(m(t.get("_gediModelContext_"),this.original),e)},E.tokenConverters.push(u),E.scope.isDirty=function(e,t){var n=t.raw()[0];return A(m(e.get("_gediModelContext_"),n instanceof u?n.original:N()))},E.scope.getAllDirty=function(t,n){var r,o,i=n.raw()[0],a=m(t.get("_gediModelContext_"),i instanceof u&&i.original),s=c(a,e);if(null==s)return null;r=s.constructor();for(var f in s)s.hasOwnProperty(f)&&(o=m(a,N(f)),r instanceof Array?A(o)&&r.push(s[f]):A(o)&&(r[f]=s[f]));return r};var D={},V={},K={},q={};return C.prototype={paths:{create:N,resolve:m,isRoot:T,isAbsolute:j,append:P},get:w,set:b,remove:_,utils:{get:c,set:p},init:function(e){this.set(e,!1)},bind:d,debind:v,trigger:h,isDirty:A,setDirtyState:x,gel:E,getNumberOfBindings:function(){function e(t){var n=t.length;for(var r in t)isNaN(r)&&(n+=e(t[r]));return n}return e(O)}},new C}var r=e("gel-js"),o=e("spec-js"),i=n;i.pathSeparator="/",i.upALevel="..",i.currentKey="#",i.rootPath="",i.pathStart="[",i.pathEnd="]",i.pathWildcard="*";var a={invalidPath:"Invalid path syntax",expressionsRequireGel:"Gel is required to use Expressions in Gedi"},s=[];t.exports=i},{"spec-js":35,"gel-js":36}],35:[function(e,t){function n(e,t){var n;t||(t=Object),t.prototype||(t.prototype={}),n=t.prototype,e.prototype=Object.create(t.prototype),e.prototype.__super__=n;var r=new Function("child","return function "+e.name+"(){child.prototype.__super__.constructor.apply(this, arguments);return child.apply(this, arguments);}")(e);return r.prototype=e.prototype,r.prototype.constructor=e.prototype.constructor=r,r}Object.create=Object.create||function(e){function t(){}if(arguments.length>1)throw new Error("Object.create implementation only accepts the first parameter.");return t.prototype=e,new t},t.exports=n},{}],36:[function(e,t){function n(e,t){for(var n=0;n<e.length&&!t(e[n],n,e);n++);return e}function r(e,t){return e.replace(/{(\d+)}/g,function(e,n){return null!=t[n]?t[n]:""})}function o(e){var t=/^[$A-Z_][0-9A-Z_$]*/i,n=e.match(t);return n&&0===n.index?n[0]:void 0}function i(e){for(var t="!=<>/&|*%-^?+\\",n=0;t.indexOf(e.charAt(n)||null)>=0&&++n;);if(n>0)return e.slice(0,n);var r=o(e);return null!=r?r:void 0}function a(e,t){return function(n){return n=o(n),n===t?new e(n,n.length):void 0}}function s(){}function u(){}function c(){}function f(){}function p(){}function l(){}function h(){}function d(){}function v(){}function g(){}function y(){}function m(){}var w=e("lang-js"),b=w.createNestingParser,_=(w.detectString,w.Token),x=w.Scope,A=e("spec-js");s=A(s,_),s.prototype.precedence=2,s.prototype.stringTerminal='"',s.prototype.name="double quoted string",s.tokenise=function(e){if(e.charAt(0)===this.prototype.stringTerminal){for(var t=0,n=0;e.charAt(++t)!==this.prototype.stringTerminal;){if(t>=e.length)throw"Unclosed "+this.name;"\\"===e.charAt(t)&&e.charAt(t+1)===this.prototype.stringTerminal&&(e=e.slice(0,t)+e.slice(t+1),n++)}return new this(e.slice(0,t+1),t+n+1)}},s.prototype.evaluate=function(){this.result=this.original.slice(1,-1)},u=A(u,s),u.prototype.stringTerminal="'",u.prototype.name="single quoted string",u.tokenise=s.tokenise,c=A(c,_),c.prototype.name="parentheses",c.tokenise=function(e){return"("===e.charAt(0)||")"===e.charAt(0)?new c(e.charAt(0),1):void 0},c.prototype.parse=b(/^\($/,/^\)$/),c.prototype.evaluate=function(e){e=new x(e);var t=this.childTokens[0];if(!t)throw"Invalid function call. No function was provided to execute.";if(t.evaluate(e),"function"!=typeof t.result)throw t.original+" ("+t.result+")"+" is not a function";this.result=e.callWith(t.result,this.childTokens.slice(1),this)},f=A(f,_),f.prototype.name="number",f.tokenise=function(e){var t={NaN:Number.NaN,"-NaN":Number.NaN,Infinity:1/0,"-Infinity":-1/0};for(var n in t)if(e.slice(0,n.length)===n)return new f(n,n.length);for(var r="0123456789-.Eex",o=0;r.indexOf(e.charAt(o)||null)>=0&&++o;);if(o>0){var i=e.slice(0,o);if(isNaN(parseFloat(i)))return;return new f(i,o)}},f.prototype.evaluate=function(){this.result=parseFloat(this.original)},p=A(p,_),p.prototype.name="semicolon",p.prototype.precedence=2,p.tokenise=a(p,"null"),p.prototype.evaluate=function(){this.result=null},l=A(l,_),l.prototype.name="undefined",l.prototype.precedence=2,l.tokenise=a(l,"undefined"),l.prototype.evaluate=function(){this.result=void 0},h=A(h,_),h.prototype.name="true",h.prototype.precedence=2,h.tokenise=a(h,"true"),h.prototype.evaluate=function(){this.result=!0},d=A(d,_),d.prototype.name="false",d.prototype.precedence=2,d.tokenise=a(d,"false"),d.prototype.evaluate=function(){this.result=!1},v=A(v,_),v.prototype.name="delimiter",v.prototype.precedence=2,v.tokenise=function(e){for(var t=0;t<e.length&&""===e.charAt(t).trim()||","===e.charAt(t);)t++;return t?new v(e.slice(0,t),t):void 0},v.prototype.parse=function(e,t){e.splice(t,1)},g=A(g,_),g.prototype.name="identifier",g.prototype.precedence=3,g.tokenise=function(e){var t=i(e);return null!=t?new g(t,t.length):void 0},g.prototype.evaluate=function(e){this.result=e.get(this.original)},y=A(y,_),y.prototype.name="period",y.prototype.precedence=1,y.tokenise=function(e){var t=".";return e.charAt(0)===t?new y(t,1):void 0},y.prototype.parse=function(e,t){this.targetToken=e.splice(t-1,1)[0],this.identifierToken=e.splice(t,1)[0]},y.prototype.evaluate=function(e){this.targetToken.evaluate(e),this.result=this.targetToken.result&&("object"==typeof this.targetToken.result||"function"==typeof this.targetToken.result)&&this.targetToken.result.hasOwnProperty(this.identifierToken.original)?this.targetToken.result[this.identifierToken.original]:void 0},m=A(m,_),m.prototype.name="function",m.tokenise=function(e){return"{"===e.charAt(0)||"}"===e.charAt(0)?new m(e.charAt(0),1):void 0},m.prototype.parse=b(/^\{$/,/^\}$/),m.prototype.evaluate=function(){var e=this.childTokens.slice(),t=e.pop();this.result=function(n,r){n=new x(n);for(var o=0;o<e.length;o++)n.set(e[o].original,r.get(o));return t.evaluate(n),t.result}};var N=[s,u,c,f,p,l,h,d,v,g,y,m],k={toString:function(e,t){return""+t.next()},"+":function(e,t){return t.next()+t.next()},"-":function(e,t){return t.next()-t.next()},"/":function(e,t){return t.next()/t.next()},"*":function(e,t){return t.next()*t.next()},isNaN:function(e,t){return isNaN(t.get(0))},max:function(e,t){for(var n=t.next();t.hasNext();)n=Math.max(n,t.next());return n},min:function(e,t){for(var n=t.next();t.hasNext();)n=Math.min(n,t.next());return n},">":function(e,t){return t.next()>t.next()},"<":function(e,t){return t.next()<t.next()},">=":function(e,t){return t.next()>=t.next()},"<=":function(e,t){return t.next()<=t.next()},"?":function(e,t){return t.next()?t.next():t.get(2)},"!":function(e,t){return!t.next()},"=":function(e,t){return t.next()==t.next()},"==":function(e,t){return t.next()===t.next()},"!=":function(e,t){return t.next()!=t.next()},"!==":function(e,t){return t.next()!==t.next()},"||":function(e,t){for(var n;t.hasNext();)if(n=t.next())return n;return n},"|":function(e,t){for(var n;t.hasNext();)if(n=t.next(),n===!0)return n;return n},"&&":function(e,t){for(var n;t.hasNext();)if(n=t.next(),!n)return!1;return n},object:function(e,t){for(var n={};t.hasNext();)n[t.next()]=t.next();return n},keys:function(e,t){var n=t.next();return"object"==typeof n?Object.keys(n):void 0},values:function(e,t){var n=t.next(),r=[];for(var o in n)r.push(n[o]);return r},invert:function(e,t){var n=t.next(),r={};for(var o in n)r[n[o]]=o;return r},extend:function(e,t){for(var n={};t.hasNext();){var r=t.next();for(var o in r)n[o]=r[o]}return n},array:function(e,t){for(var n=[];t.hasNext();)n.push(t.next());return n},map:function(e,t){var r=t.next(),o=Array.isArray(r),i=o?[]:{},a=t.next();if(o)n(r,function(t,n){i[n]=e.callWith(a,[t])});else for(var s in r)i[s]=e.callWith(a,[r[s]]);return i},pairs:function(e,t){var n=t.next(),r=[];for(var o in n)n.hasOwnProperty(o)&&r.push([o,n[o]]);return r},flatten:function(e,t){function n(e){for(var t,r=[],i=0;i<e.length;i++){t=e[i];for(var a=0;a<t.length;a++)!o&&Array.isArray(t[a])?r.push(n(t)):r.push(e[i][a])}return r}var r=t.next(),o=t.hasNext()&&t.next();return n(r)},sort:function(e,t){var n,t=t.all(),r=t[0],o=t[1];return Array.isArray(r)?n=r.sort(function(t,n){return e.callWith(o,[t,n])}):void 0},filter:function(e,t){var t=t.all(),r=[];if(t.length<2)return t;var o=t[0],i=t[1];return Array.isArray(o)?(n(o,function(t){"function"==typeof i?e.callWith(i,[t])&&r.push(t):t===i&&r.push(t)}),r):void 0},findOne:function(e,t){var r,t=t.all();if(t.length<2)return t;var o=t[0],i=t[1];return Array.isArray(o)?(n(o,function(t){return e.callWith(i,[t])?(r=t,!0):void 0}),r):void 0},concat:function(e,t){for(var n=t.next();t.hasNext();){if(null==n||!n.concat)return void 0;var r=t.next();Array.isArray(r)&&(n=n.concat(r))}return n},join:function(e,t){return t=t.all(),t.slice(1).join(t[0])},slice:function(e,t){var n,r,o=t.next();return t.hasNext()&&(n=o,o=t.next()),t.hasNext()&&(r=o,o=t.next()),o.slice(n,r)},split:function(e,t){return t.next().split(t.hasNext()&&t.next())},last:function(e,t){var n=t.next();if(Array.isArray(n))return n.slice(-1).pop()},first:function(e,t){var n=t.next();if(Array.isArray(n))return n[0]},length:function(e,t){return t.next().length},getValue:function(e,t){var n=t.next(),r=t.next();if(n&&"object"==typeof n)return n[r]},compare:function(e,t){for(var n,t=t.all(),r=t.pop(),o=t.pop(),i=!0;t.length;){n=t.pop();for(var a in n)e.callWith(r,[n[a],o[a]])||(i=!1)}return i},contains:function(e,t){var r,t=t.all(),o=t.shift(),i=!1,a=!1;if(null!=o&&("boolean"==typeof o&&(a=o,o=t.shift()),r=t.pop(),null!=o&&o.indexOf)){if("string"!=typeof r||a)return o.indexOf(r)>=0;if(r=r.toLowerCase(),Array.isArray(o))n(o,function(e){return"string"==typeof e&&e.toLowerCase()===r.toLowerCase()?i=!0:void 0});else if("string"==typeof o&&o.toLowerCase().indexOf(r)>=0)return i=!0;return i}},charAt:function(e,t){var n,r=t.next();return t.hasNext()&&(n=t.next()),"string"==typeof r?r.charAt(n):void 0},toLowerCase:function(e,t){var n=t.next();return"string"!=typeof n?void 0:n.toLowerCase()},toUpperCase:function(e,t){var n=t.next();return"string"!=typeof n?void 0:n.toUpperCase()},format:function(e,t){var t=t.all();return r(t.shift(),t)},refine:function(e,t){for(var t=t.all(),n="boolean"==typeof t[0]&&t.shift(),r=t.shift(),o={},i=0;i<t.length;i++)t[i]=t[i].toString();for(var a in r)t.indexOf(a)>=0?!n&&(o[a]=r[a]):n&&(o[a]=r[a]);return o},date:function(){var e=function(e,t){return t.length?new Date(t.length>1?t.all():t.next()):new Date};return e.addDays=function(e,t){var n=t.next();return new Date(n.setDate(n.getDate()+t.next()))},e}(),toJSON:function(e,t){return JSON.stringify(t.next())},fromJSON:function(e,t){return JSON.parse(t.next())},fold:function(e,t){var t=t.all(),n=t.pop(),r=t.pop(),o=t[0],i=r;if(t.length>1&&(o=t),!o||!o.length)return i;for(var a=0;a<o.length;a++)i=e.callWith(n,[i,o[a]]);return i},partial:function(e,t){var n=t.all(),r=n.shift();return function(e,t){var o=t.all();return e.callWith(r,n.concat(o))}},flip:function(e,t){var n=t.all().reverse(),r=n.pop();return function(e){return e.callWith(r,n)}},compose:function(e,t){var n=t.all().reverse();return function(e,t){for(var r=e.callWith(n[0],t.all()),o=1;o<n.length;o++)r=e.callWith(n[o],[r]);return r}},apply:function(e,t){var n=t.next();return outerArgs=t.next(),e.callWith(n,outerArgs)}};Gel=function(){var e={},t=new w;return e.lang=t,e.tokenise=function(t){return e.lang.tokenise(t,this.tokenConverters)},e.evaluate=function(e,n,r){var o=new w.Scope;return o.add(this.scope).add(n),t.evaluate(e,o,this.tokenConverters,r)},e.tokenConverters=N.slice(),e.scope=Object.create(k),e},Gel.Token=w.Token,Gel.Scope=w.Scope,t.exports=Gel},{"lang-js":37,"spec-js":38}],38:[function(e,t){function n(e,t){var n;t||(t=Object),t.prototype||(t.prototype={}),n=t.prototype,e.prototype=Object.create(t.prototype),e.prototype.__super__=n;var r=new Function("child","return function "+e.name+"(){child.prototype.__super__.constructor.apply(this, arguments);return child.apply(this, arguments);}")(e);return r.prototype=e.prototype,r.prototype.constructor=e.prototype.constructor=r,r}Object.create=Object.create||function(e){function t(){}if(arguments.length>1)throw new Error("Object.create implementation only accepts the first parameter.");return t.prototype=e,new t},t.exports=n
},{}],37:[function(e,t){function n(e,t){for(var n=0;n<e.length&&!t(e[n],n,e);n++);return e}function r(e,t,r){var o=0,i=this,a={callee:r,length:t.length,raw:function(e){var r=t.slice();return e&&n(r,function(e){e instanceof h&&e.evaluate(i)}),r},getRaw:function(e,n){var r=t[e];return n&&r instanceof h&&r.evaluate(i),r},get:function(e){var n=t[e];return n instanceof h?(n.evaluate(i),n.result):n},hasNext:function(){return o<t.length},next:function(){if(!this.hasNext())throw"Incorrect number of arguments";return t[o]instanceof h?(t[o].evaluate(i),t[o++].result):t[o++]},all:function(){for(var e=[];this.hasNext();)e.push(this.next());return e}};return e(i,a)}function o(e){this.__scope__={},this.__outerScope__=e}function i(e,t){return function(n,r){if(!this.original.match(e))throw"Invalid nesting. No opening token was found matching "+e.toString();for(var o=r,i=1;o++,o<=n.length&&i;){if(!n[o])throw"Invalid nesting. No closing token was found matching "+t.toString();n[o].original.match(e)&&i++,n[o].original.match(t)&&i--}var a=n.splice(r+1,o-1-r);a.pop(),this.childTokens=c(a)}}function a(e,t){for(var n=0;n<e.length;n++){var r=e[n].tokenise(t);if(r)return r}}function s(e){return e.slice().sort(function(t,n){var r=t.precedence-n.precedence;return r?r:e.indexOf(t)-e.indexOf(n)})}function u(e,t,n){if(!e)return[];if(n&&n[e])return n[e].slice();t=s(t);var r,o=e,i=[],u=0;do{r=e.length;var c;if(c=a(t,e))e=e.slice(c.length),u+=c.length,i.push(c);else if(e.length===r)throw"Unable to determine next token in expression: "+e}while(e);return n&&(n[o]=i.slice()),i}function c(e){for(var t=s(e),n=t[0],r=0;n&&1==n.parsed;)n=t[r++];return n?(n.parse&&n.parse(e,e.indexOf(n)),n.parsed=!0,c(e)):e}function f(e,t){t=t||new o;for(var n=0;n<e.length;n++){var r=e[n];r.evaluate(t)}return e}function p(e){var t=[];for(var n in e)t.push({expression:n,time:e[n].time,calls:e[n].calls,averageTime:e[n].averageTime});t.sort(function(e,t){return t.time-e.time}).slice(0,10).forEach(function(e){console.log(["Expression: ",e.expression,"\n","Average evaluation time: ",e.averageTime,"\n","Total time: ",e.time,"\n","Call count: ",e.calls].join(""))})}function l(){function e(e){var t=a[e.expression]=a[e.expression]||{time:0,calls:0};t.time+=e.time,t.calls++,t.averageTime=t.time/t.calls}var t={},n={},i={},a={};return t.printTopExpressions=function(){p(a)},t.parse=c,t.tokenise=function(e,t){return u(e,t,n)},t.evaluate=function(t,r,a,s){var u,c,p,l=this,h=t;if(!(r instanceof o)){var d=r;r=new o,r.add(d)}if(Array.isArray(t))return f(t,r).slice(-1).pop();i[h]?u=i[h].slice():(u=l.parse(l.tokenise(t,a,n)),i[h]=u);var v=new Date;return c=f(u,r),e({expression:t,time:new Date-v}),s?c.slice():(p=c.slice(-1).pop(),p&&p.result)},t.callWith=r,t}var h=e("./src/token");o.prototype.get=function(e){return e in this.__scope__&&this.__scope__.hasOwnProperty(e)?this.__scope__[e]:this.__outerScope__&&this.__outerScope__.get(e)},o.prototype.set=function(e,t,n){if(n){for(var r=this;r&&!(e in r.__scope__);)r=r.__outerScope__;r&&r.set(e,t)}return this.__scope__[e]=t,this},o.prototype.add=function(e){for(var t in e)this.__scope__[t]=e[t];return this},o.prototype.isDefined=function(e){return e in this.__scope__?!0:this.__outerScope__&&this.__outerScope__.isDefined(e)||!1},o.prototype.callWith=r,l.createNestingParser=i,l.Scope=o,l.Token=h,t.exports=l},{"./src/token":39}],39:[function(e,t){function n(e,t){this.original=e,this.length=t}n.prototype.name="token",n.prototype.precedence=0,n.prototype.valueOf=function(){return this.result},t.exports=n},{}]},{},[1]);